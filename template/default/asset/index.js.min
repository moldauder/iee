(function(e){var f=e.DOM,b=e.Event,a=e.IO,c=e.Node,d=e.Anim;e.use("waterfall",function(m,l){var g;var j=true;var k=m.UA.ie<9;var q=f.get("#loading");if(k){f.addStyleSheet("#itemlist .extra,#itemlist .mask{display: none;background:#000}")}function n(){q.innerHTML='<p class="end"></p>';q.style.visibility="visible"}function p(){q.innerHTML='<p><img src="http://pic.yupoo.com/iewei/C6Gb0faQ/PMs7M.gif" width="202" height="70" alt="加载中" /></p>';q.style.visibility="visible"}var o=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];function h(s){var r=s.split(" ")[0].split("-");r[1]=o[r[1]-1];return r}var i=new l.Loader({container:"#waterfall",minColCount:3,colWidth:325,adjustEffect:{duration:0.5,easing:"easeInStrong"},load:function(s,r){if(!j){n();return r()}p();a({url:"/query",data:{id:g,from:"fp"},dataType:"jsonp",success:function(v){j=v.next;if(v.size){var t="";m.each(v.list,function(w){var x=h(w.modified);g=w.id;t+='<a href="/'+w.id+'" class="pin ks-waterfall"><img src="'+w.img+'" width=320 height=420 /><div class=extra><div class=mask></div><div class=stddate><span class=day>'+x[2]+"</span><span class=month>"+x[1]+"</span><span class=year>"+x[0]+"</span></div><div class=title>"+w.title+"</div><div class=desc>"+w.content+"</div><div class=author><s></s>"+w.nick+"</div></div></a>"});q.style.visibility="hidden";var u=document.createElement("div");u.innerHTML=t;s(m.all(u.children))}else{n();r()}},error:function(){}})}})});(function(g){if(!g){return}var h=f.create('<div class="submit"></div>');h.innerHTML='<s></s><s class="arrow"></s>';f.get("#socialm").appendChild(h);b.on(h,"click",function(){b.remove(this,"click");i()});var i=function(){var q=f.create('<div id="submiturl" class="submiturl"></div>');q.innerHTML=g.value;g.parentNode.replaceChild(q,g);var j=f.get("div.box",q);var r=f.get("div.fieldCont",q);var t=f.get("form",q);var o=f.get("span.err",q);var m=f.query("input",q);var s=f.get("div.formCont",q);var k=0;var l=false;b.on(h,"click",function(){if(l){n()}else{l=true;(new d(q,{height:f.outerHeight(j)},0.6,"easeOutStrong",function(){q.style.height="auto";f.addClass(h,"submit-expand")})).run()}});b.fire(h,"click");var n=function(){if(l){k=0;l=false;(new d(q,{height:0},0.6,"easeInStrong",function(){f.css(s,{opacity:1,display:"block"});r.style.height="120px";o.innerHTML="";t.reset();f.removeClass(h,"submit-expand");f.remove(f.get("div.thanks",q))})).run()}};b.on(f.get("span.close",q),"click",function(){n()});var p=function(u){k=u;(new d(r,{height:u},0.3,"easeOutStrong")).run()};e.each(m,function(v){b.on(v,"focus",function(){f.addClass(this.parentNode,"field-focus")});var u=v.name;if("url"===u){b.on(v,"focus",function(){if(k<180){p(180)}})}else{if("remark"===u){b.on(v,"focus",function(){if(k<220){p(220)}})}}b.on(v,"blur",function(){if(!e.trim(this.value)){this.value="";f.removeClass(this.parentNode,"field-focus")}})});b.on(f.get("button",q),"click",function(v){v.halt();var u=t.elements.url;if(!e.trim(u.value)){o.innerHTML="请输入您要推荐的网址";return}a({url:"/index/submit",type:"post",form:t,success:function(){(new d(s,{opacity:0},0.3,"easeOutStrong",function(){var x=f.outerHeight(s);s.style.display="none";var w=f.create('<div class="thanks"></div>');f.insertAfter(w,s);w.style.height=x+"px";(new d(w,{opacity:1},0.4,"easeInStrong",function(){setTimeout(function(){n()},2400)})).run()})).run()}})})}})(f.get("#sh"))})(KISSY);