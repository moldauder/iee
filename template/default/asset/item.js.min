(function(g){var l=g.DOM;var k=g.Event;var b=g.IO;var i=g.Anim;var j=g.JSON;var a=false;var f=history.pushState;var c=l.get("#slider");var e=0;if(f){history.pushState({id:curPostId},document.title,location.href)}function h(m,p){var n=l.html(l.get("h1.title",m))+" | 一味";document.title=n;var o=m.id.substr(4);if(f){if(p){history.pushState({id:o},n,"/"+o)}}else{location.hash="!"+o}l.html("#trigger",l.val(l.get("textarea",m)))}function d(m,n){n=1===(n||1);g.each(l.children(c),function(p,o){if(p!==m){return}(new i(c,{marginLeft:-o*990},0.6,"easeBothStrong",function(){h(m,n)})).run()})}k.on(window,"keyup",function(o){var q="";var p=o.keyCode;if(39===p||34===p){q="next"}else{if(37===p||33===p){q="prev"}}if(q){var n=l.get("a."+q,"#trigger");if(n){var m=q+"-hover";l.addClass(n,m);(new i(n,{opacity:0.15},0.3,"easeBothStrong",function(){l.removeClass(n,m)})).run();k.fire(n,"click")}}});if(f){window.onpopstate=function(m){var o=m.state;if(!o){return}var n=l.get("#post"+o.id);if(n){d(n,2)}}}k.on("#trigger","click",function(m){m.halt();if(a){return}var o=m.target;var p=l.attr(o,"data-id");var n=l.get("#post"+p);if(n){d(n)}else{a=true;b({type:"get",url:"/"+p+"?type=json",success:function(q){var r=document.createElement("div");r.className="panel";r.id="post"+p;r.innerHTML=q;l.width(c,l.width(c)+990);var s=l.hasClass(o,"prev");if(s){l.prepend(r,c);l.css(c,"marginLeft",parseInt(l.css(c,"marginLeft"),10)-990)}else{c.appendChild(r)}iee.util.stdShareHolder(r);d(r);a=false},error:function(){window.location=o.href}})}});if(window.hashId){c.innerHTML='<p style="line-height:300px;color:#666;font-size:16px;letter-spacing:2px;text-align:center">正在搬运灵感...</p>';b({type:"get",url:"/"+hashId+"?type=json",success:function(m){c.innerHTML='<div class="panel" id="post'+hashId+'">'+m+"</div>";h(l.get("#post"+hashId));l.css("#trigger","visibility","visible")},error:function(){window.location="/"+hashId}})}})(KISSY);