KISSY.add("iee/util",function(S,DOM,Event){var Util={};var messageCenter=S.mix({},S.EventTarget);var cache={};function fnid(el){var id=DOM.data(el,"fnid");if(!id){id="fn"+S.guid();DOM.data(el,"fnid",id)}return id}Util.make=function(root){S.each(DOM.query(".fn-util",root||document.body),function(el){var matches=el.className.match(/\bfn-(?!util)([\w-]+)\b/);if(matches){var name=matches[1];var key=fnid(el)+"/"+name;if(cache[key]){return}cache[key]=1;S.use("iee/util."+name,function(S,Cls){var obj=new Cls(el);messageCenter.fire(key,{obj:obj});cache[key]=obj})}})};Util.use=function(el,name,then){if(S.isArray(el)){then=name}else{el=[[el,name]]}var num=el.length;var objList=new Array(num);var ready=function(obj,idx){objList[idx]=obj;num--;if(0==num){then.apply({},objList)}};S.each(el,function(arr,idx){el=DOM.get(arr[0]);name=arr[1];var key=fnid(el)+"/"+name;var obj=cache[key];if(obj&&true!==obj){ready(obj,idx)}else{messageCenter.on(key,function(vo){ready(vo.obj,idx)})}})};return Util},{requires:["dom","event"]});