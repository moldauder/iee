KISSY.add("iee/fp.base",function(S,DOM,Event,Anim){function createShareEl(t,e){var a=document.createElement("a");a.innerHTML="分享灵感",a.className="go-share",a.target="_blank",a.href=Base.shareLink(e),t.parentNode.replaceChild(a,t)}function packShareText(t,e){var a=t+"。"+e,n=108;return a=a.length>n?a.substr(0,n-3)+"...":a,encodeURIComponent("#中意一味# "+a)}var Base={},MonthName=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];return Base.stddate=function(t){var e=t.split(" ")[0].split("-");if(3===e.length){var a=e[1]-1;return a>-1&&12>a&&(e[1]=MonthName[a]),'<div class="stddate"><span class="day">'+e[2]+'</span><span class="month">'+e[1]+'</span><span class="year">'+e[0]+"</span></div>"}return""},Base.filterHtmlTag=function(t){var e=document.createElement("div");return e.innerHTML=t,DOM.text(e)},Base.shareLink=function(t){return"http://v.t.sina.com.cn/share/share.php?appkey=1859607314&ralateUid=2802115114&"+S.param(t)},Base.parsePostShare=function(t){S.each(DOM.query("ins.post-share",t||document.body),function(t){var e=DOM.parent(t,"div.stdpost");e&&createShareEl(t,{pic:DOM.attr(DOM.get("img",e),"src"),url:location.href,title:packShareText(DOM.html(DOM.get(".title",e)),DOM.text(DOM.get("div.content",e)))})})},Base.initCategory=function(t,e){var a=DOM.get("#category"),n=DOM.create('<div class="category-placeholder"></div>');DOM.insertBefore(n,a);var r,s=DOM.get("div.sub",a),i=function(a){var n=t[DOM.attr(a,"data-cat")];if(S.isArray(n)||0!==n.length){var i=DOM.data(a,"isExpand");if(i){var o=DOM.get("div.sub-cat",s);o&&new Anim(o,{marginTop:0-DOM.outerHeight(o)},.5,"easeOutStrong").run(),r=null}else{if("color"===n[0].type){var c='<div class="sub-cat sub-cat-color"><div class="list">';S.each(n,function(t){c+='<a target="_self" class="cat-'+t.alias+(e===t.id?" active":"")+'" href="?cat='+t.alias+'"><span>'+t.name.substr(t.name.indexOf("/")+1)+"</span></a>"}),c+="</div></div>"}s.innerHTML=c;var o=DOM.get("div.sub-cat",s),l=DOM.outerHeight(o);o.style.marginTop=0-l+"px",s.style.height=l+"px",new Anim(o,{marginTop:0},.5,"easeOutStrong").run(),r=a}DOM.data(a,"isExpand",!i)}};S.each(DOM.query("a",DOM.query("li.collapse",a)),function(e){var a=t[DOM.attr(e,"data-cat")];S.isArray(a)&&a.length&&Event.on(e,"click",function(t){t.halt(),i(this)})});var o;Event.on(window,"scroll",function(){DOM.offset(n).top<DOM.scrollTop()?(o||(o=!0,DOM.addClass(a,"category-fixed"),n.style.height=DOM.outerHeight(a)),r&&i(r)):(o=!1,n.style.height="0",DOM.removeClass(a,"category-fixed"))})},Base.init=function(){Event.on(document.body,"click",function(ev){var target=ev.target,act=(DOM.attr(target,"data-act")||"").split("/");if(2===act.length){"A"===target.nodeName&&ev.preventDefault();var method=act[1],pos=method.indexOf(":"),args=[target];if(pos>-1){try{args=args.concat(eval("["+method.substr(pos+1)+"]"))}catch(e){}method=method.substr(0,pos)}S.use("iee/"+act[0],function(t,e){e[method].apply(e,args)})}}),S.use("iee/fp.gotop",function(t,e){e.init()}),this.initCategory(window.subCat,window.curCatId)},Base},{requires:["dom","event","anim"]});