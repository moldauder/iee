KISSY.add("iee/util.validation",function(e,n,i,t){function r(i,t){this.el=n.get(i),this.config=e.merge({when:"blur keyup"},t),this.init()}return e.augment(r,e.EventTarget,{init:function(){var r=this;e.each(r.el.elements,function(a){var c=n.attr(a,"data-validate");if(c)try{var u=t.parse(c);e.isArray(u)&&(u=e.isArray(u[0])?u:[u]),n.data(a,"rule",u),i.on(a,r.config.when,function(){r.doCheck(a)})}catch(l){}})},validate:function(n){var i=this,t=i.el.elements.length,r=!0;n=e.isFunction(n)?n:function(){},e.each(i.el.elements,function(e){i.doCheck(e,function(e){e||(r=!1),t--,0===t&&n(r)})})},doCheck:function(i,t){var a=this;t=e.isFunction(t)?t:function(){},a.clearErr(i);var c=n.data(i,"rule");if(!c)return t(!0);var u=c.length,l=!0;e.each(c,function(e){r.Rule.check(i,function(e){u--,!0!==e&&(a.addErr(i,e),l=!1),0===u&&t(l)},e)})},addErr:function(e,i,t){var r=n.create("<div></div>");r.innerHTML="<p>"+i+"</p>",r.className="field-formtip "+(t||"err"),n.parent(e,"div.field-bd").appendChild(r)},clearErr:function(e){n.remove(n.query("div.field-formtip",n.parent(e,"div.field-bd")))}}),r.Rule={add:function(e,n){var i=this.rules||{};i[e]=n,this.rules=i},check:function(i,t,r){var a=r[0],c=this.rules;a in c&&c[a].apply({},[e.trim(n.val(i)),t].concat(r.slice(1)))}},r.Rule.add("require",function(e,n,i){n(e?!0:i||"此项必须填写")}),r.Rule.add("equal",function(i,t,r,a){return t(i===e.trim(n.val("#"+r))?!0:a||"两次输入的值不一致")}),r},{requires:["dom","event","json"]});