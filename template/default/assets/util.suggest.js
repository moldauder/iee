KISSY.add("iee/util.suggest",function(t,e,i,s){function n(i,s){this.textInput=e.get(i),this.config=t.merge({},s),this._init()}return t.augment(n,t.EventTarget,{_init:function(){var n=this;n._initList(),n._request=t.throttle(function(){var c=t.trim(n.textInput.value);return c?void s.get(n.config.url,{q:c},function(s){i.detach(e.children(n.listEl),"mouseenter mouseleave");var o="";t.each(s,function(t,e){o+='<div tabindex="0" class="suggest-list-item">'+n.config.render(t,c,e)+"</div>"}),n.listEl.innerHTML=o,n.itemList=e.children(n.listEl),n.length=n.itemList.length,i.on(n.itemList,"mouseenter mouseleave",function(t){"mouseenter"===t.type?(n.activeItem=this,e.addClass(this,"active")):e.removeClass(this,"active")}),i.on(n.itemList,"click",function(){n._select()}),s.length?n._show():n._hide()},"json"):n._hide()},120),n._monitor(),i.on(n.textInput,"keydown",function(t){if(n._isShow&&n.length){var e=t.keyCode;40===e?n._activeNext():38===e?n._activePrev():13===e&&n._select()}}),i.on(document,"click",function(e){e.target!==n.textInput&&t.later(function(){n._hide()},50)})},_initList:function(){if(!this.listEl){var t=e.create("<div></div>");t.className="suggest-list"+(this.config.cls?" "+this.config.cls:""),e.insertBefore(t,document.body.lastChild),this.listEl=t}this.listEl.display="none"},_show:function(){var t=this,i=e.offset(t.textInput),s=i.top+e.outerHeight(t.textInput)-1;e.css(this.listEl,{width:e.outerWidth(t.textInput)-2,top:s,left:i.left,height:"auto",display:"block"});var n=e.outerHeight(this.listEl),c=e.viewportHeight()+e.scrollTop()-s-n;0>c&&(this.listEl.style.height=n+c-20+"px"),t._isShow=!0},_hide:function(){this._isShow=!1,this.listEl.style.display="none"},_activeNext:function(){var t=this.activeItem?e.next(this.activeItem):null;t=t||this.itemList[0],this._activate(t)},_activePrev:function(){var t=this.activeItem?e.prev(this.activeItem):null;t=t||this.itemList[this.length-1],this._activate(t)},_activate:function(t){t!==this.activeItem&&(e.removeClass(this.activeItem,"active"),e.addClass(t,"active"),this.activeItem=t)},_select:function(){var e=this;i.detach(e.textInput,"valuechange focus"),e.fire("select",{element:e.activeItem}),e._hide(),t.later(function(){e._monitor()},120)},_monitor:function(){var t=this;i.on(t.textInput,"valuechange focus",function(){t._request()})}}),n},{requires:["dom","event","ajax","iee/util.suggest.css"]});