KISSY.add("iee/fp.waterfall",function(t,n,i){function e(n){this.config=t.merge({diff:200,effect:{type:"fadeIn",duration:.5,easing:"easeInStrong"},minColCount:1},n)}return t.augment(e,t.EventTarget,{start:function(){var t=this;t.container=n.get(t.config.container),t.data=[],t.lazyImgs=[],t.checkLazyElements(t.container),i.on(window,"scroll",function(){t.check()}),i.on(window,"resize",function(){t.resize()}),t.resize(),t.check()},checkLazyElements:function(i){var e=[];t.each(n.query("img",i),function(t){t.getAttribute("data-lazy")&&e.push(t)}),this.lazyImgs=this.lazyImgs.concat(e)},loadData:function(){var t=this;t._loading=!0,t.config.load(function(n,i){t._loading=!1,t.addItems(n,i)},function(){t.end()})},end:function(){self.isEnd=!0},addItems:function(n,i){var e=this;if(e.data=e.data.concat(n),!e._adding){e._adding=!0;var a=e.config.effect,o=function(){if(0===e.data.length)return e._adding=!1,t.isFunction(i)&&i(),e.check();var n=e.data.shift();e.checkLazyElements(n);var c=t.one(n);c.appendTo(e.container),c.css({display:"none",visibility:""}),c[a.type](a.duration,0,a.easing),setTimeout(o,50)};o()}},check:function(){var i=this,e=n.scrollTop()+n.viewportHeight();i.lazyImgs=t.filter(i.lazyImgs,function(t){if(n.offset(t).top-200<=e){var i=t.getAttribute("data-lazy");return i&&(t.removeAttribute("data-lazy"),t.src=i),!1}return!0}),!i.isEnd&&!i._loading&&!i._adding&&n.offset(i.container).top+n.outerHeight(i.container)-i.config.diff<=e&&i.loadData()},resize:function(){var t=this,i=t.config,e=Math.floor(n.viewportWidth()/i.colWidth);e=e<i.minColCount?i.minColCount:e,e=e>i.maxColCount?i.maxColCount:e,n.width(t.container,e*i.colWidth),t.fire("resize",{colCount:e})}}),e},{requires:["dom","event"]});