KISSY.add("iee/fp.item",function(t,i,e,n,s,a){var r=history.pushState,o={};return o.init=function(){this.sliderEl=i.get("#slider"),this.curPostId=i.attr(i.children(this.sliderEl),"id").substr(4),r&&history.pushState({id:o.curPostId},document.title,location.href),this.initEvents(),this.handleHash(),this.handleStdPost(this.sliderEl)},o.handleHash=function(){var t=location.hash.substr(2);if(t.match(/^\d+$/)){var e=this;e.sliderEl.innerHTML='<p style="line-height:300px;color:#666;font-size:16px;letter-spacing:2px;text-align:center">正在搬运灵感...</p>',s({type:"get",url:"/"+t+"?async=y",success:function(n){e.sliderEl.innerHTML='<div class="panel" id="post'+t+'">'+n+"</div>",e.update(i.get("#post"+t)),i.css("#trigger","visibility","visible")},error:function(){window.location="/"+t}})}},o.initEvents=function(){e.on(window,"keyup",function(t){var s="",a=t.keyCode;if(39===a||34===a?s="next":(37===a||33===a)&&(s="prev"),s){var r=i.get("a."+s,o.albumMode?"#albumTrigger":"#trigger");if(r){var c=s+"-hover";i.addClass(r,c),new n(r,{opacity:.15},.3,"easeBothStrong",function(){i.removeClass(r,c)}).run(),e.fire(r,"click")}}})},o.prev=function(t){this.switchTo(i.attr(t,"href").substr(1),"prev")},o.next=function(t){this.switchTo(i.attr(t,"href").substr(1),"next")},o.switchTo=function(t,e){var n=i.get("#post"+t);n?this.switchPost(n):this.load(t,e)},o.switchPost=function(e,s){var a=this,r=a.sliderEl;t.each(i.children(r),function(t,i){t===e&&new n(r,{marginLeft:990*-i},.6,"easeBothStrong",function(){a.update(e,s)}).run()})},o.update=function(t,e){var n=i.text(i.get("h1.title",t))+" | 一味";document.title=n;var s=t.id.substr(4);r?1===(e||1)&&history.pushState({id:s},n,"/"+s):location.hash="!"+s,i.html("#trigger",i.val(i.get("textarea",t)))},o.load=function(t,e){var n=this;n._loading||(n._loading=!0,s({type:"get",url:"/"+t+"?async=y",success:function(s){var a=document.createElement("div");a.className="panel",a.id="post"+t,a.innerHTML=s;var r=n.sliderEl;i.width(r,i.width(r)+990),"prev"===e?(i.prepend(a,r),i.css(r,"marginLeft",parseInt(i.css(r,"marginLeft"),10)-990)):r.appendChild(a),n.switchPost(a),n.handleStdPost(a),n._loading=!1},error:function(){window.location="/"+t}}))},o.handleStdPost=function(t){a.parsePostShare(t),this.initAlbum(t)},o.initAlbum=function(n){var s=i.get("div.albumitem",n);if(s){var r=i.children(s),c=[];t.each(r,function(t){c.push({title:i.html(i.get("div.title",t)),img:i.attr(i.get("img",t),"src"),fullcontent:i.html(i.get("div.desc",t)),outer_url:i.attr(t,"data-url")})}),t.each(r,function(i,n){e.on(i,"click",function(i){i.halt(),t.use("iee/fp.album",function(t,i){i.detach("hide"),i.on("hide",function(){o.albumMode=!1}),i.show(c,{switchTo:n}),o.albumMode=!0,a.parsePostShare()})})}),t.use("iee/fp.album")}},r&&(window.onpopstate=function(t){var e=t.state;if(e){var n=i.get("#post"+e.id);n&&o.switchPost(n,2)}}),o},{requires:["dom","event","anim","ajax","iee/fp.base"]});