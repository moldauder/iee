KISSY.add("iee/util.modal",function(i,e,t,s,l){function a(i){this.init(),i=i||{},this.setTitle(i.title),this.setBody(i.body),this.setFooter(i.footer),i.cls&&(e.addClass(this.el,i.cls),e.addClass(this.maskEl,i.cls+"-mask")),this.params=i}function o(){}return i.augment(a,i.EventTarget,{init:function(){var i=this;i.el=e.create('<div class="modal"></div>'),i.el.innerHTML='<div class="modal-header"></div><div class="modal-body"></div><div class="modal-footer"></div>',i.headerEl=e.get("div.modal-header",i.el),i.bodyEl=e.get("div.modal-body",i.el),i.footerEl=e.get("div.modal-footer",i.el),e.insertBefore(i.el,document.body.lastChild),i.maskEl=e.create('<div class="modal-mask"></div>'),e.insertBefore(i.maskEl,i.el),t.on(window,"scroll resize",function(){i.isShow&&i.center()}),t.on(i.footerEl,"click",function(t){"true"===e.attr(t.target,"data-dismiss")&&i.hide()})},setTitle:function(i){i?(this.headerEl.innerHTML=i,this.headerEl.style.display="block"):this.headerEl.style.display="none"},setBody:function(i){this.bodyEl.innerHTML=i||""},setFooter:function(e){if(e){if(i.isArray(e)){var t="";i.each(e,function(i){var e=["btn"];i.primary&&e.push("btn-primary");var s=i.dismiss;s=s?' data-dismiss="true" ':"",t+=i.href?'<a class="'+e.join(" ")+'"  href="'+i.href+'" '+s+' target="'+(i.target||"_blank")+'">'+i.title+"</a>":'<span tabindex="0" class="'+e.join(" ")+'" '+s+' data-act="'+i.act+'">'+i.title+"</span>"}),this.footerEl.innerHTML=t}else this.footerEl.innerHTML=e;this.footerEl.style.display="block"}else this.footerEl.style.display="none"},open:function(i,e){var t=this;t.setTitle(e),t.setBody("加载中..."),t.show(),s.get(i,(new Date).getTime(),function(i){t.setBody(i),t.center()},"html")},show:function(){var i=this;i.maskEl.style.visibility="visible",i.el.style.visibility="visible",i.isShow=!0,i.center(),"fade"===i.params.effect?(e.css(i.el,"opacity",0),new l(i.el,{opacity:1},.6,"easeOutString",function(){i.fire("show")}).run()):i.fire("show")},hide:function(){var i=this;i.isShow=!1,i.maskEl.style.visibility="hidden","fade"===i.params.effect?new l(i.el,{opacity:0},.6,"easeInString",function(){i.el.style.visibility="hidden",i.fire("hide")}).run():(i.el.style.visibility="hidden",i.fire("hide"))},center:function(){var i=this.el;e.css(i,{top:e.scrollTop()+3*(e.viewportHeight()-e.outerHeight(i))/7,left:e.scrollLeft()+(e.viewportWidth()-e.outerWidth(i))/2})}}),i.augment(o,{show:function(t){var s=this;s._init(),s.tipEl.innerHTML=t||"处理中...";var l,a=0,o=s.els,n=s.length;e.removeClass(o),s._stop();var r=function(){e.removeClass(l,"active"),l=o[a++],e.addClass(l,"active"),a>=n&&(a=0),s.timer=i.later(r,300)};r(),s.modal.show()},_stop:function(){this.timer&&this.timer.cancel()},hide:function(){this.modal&&(this._stop(),this.modal.hide())},_init:function(){if(!this.modal){var i='<div class="list">',t=12;do i+="<span></span>",t--;while(t>0);i+='</div><div class="tip"></div>';var s=new a({cls:"progressbar",body:i}),l=s.bodyEl;this.tipEl=e.get("div.tip",l),this.els=e.children(e.get("div.list",l)),this.length=this.els.length,this.modal=s}}}),a.ProgressBar=o,a},{requires:["dom","event","ajax","anim","iee/util.modal.css"]});