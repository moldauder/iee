KISSY.add("iee/fp.author",function(i,t,e,a,n,s,l){var c={};return c.init=function(){this.initWaterfall(),e.on(window,"keyup",function(i){var a="",s=i.keyCode;if(39===s||34===s?a="next":(37===s||33===s)&&(a="prev"),a){var l=t.get("a."+a,"#albumTrigger");if(l){var c=a+"-hover";t.addClass(l,c),new n(l,{opacity:.15},.3,"easeBothStrong",function(){t.removeClass(l,c)}).run(),e.fire(l,"click")}}})},c.initWaterfall=function(){function n(){r.innerHTML='<p class="end"></p>',r.style.visibility="visible"}function o(){r.innerHTML='<p><img src="http://pic.yupoo.com/iewei/C6Gb0faQ/PMs7M.gif" width="202" height="70" alt="加载中" /></p>',r.style.visibility="visible"}var d,r=t.get("#loading"),u=new l({container:"#waterfall",colWidth:990,maxColCount:1,minColCount:1,load:function(l,u){o(),a({url:"/query/all",data:{id:d,cat:window.curCatId,author:window.authorId},dataType:"json",success:function(a){if(a.length){var o="";i.each(a,function(i){d=i.id;var t=i.buylink||i.outer_url;o+='<div class="post pin"><div class="stdpost"><div class="core"><div class="photo">'+(t?'<a title="'+i.title+'" href="'+t+'">':"")+'<img src="'+i.img+'" width="320" height="420"/>'+(t?"</a>":"")+'</div><div class="detail"><h2 class="title">'+i.title+'</h2><div class="content">'+i.fullcontent+"</div>"+(i.price&&"0"!==i.price?'<div class="price">'+i.price+"</div>":"")+'<div class="action">'+(t?'<a class="go-view" href="'+t+'">点此拥有</a>':"")+'<ins class="post-share"></ins></div>'+(t&&"n"===i.onsale?'<ins class="off-sign"></ins>':"")+"</div></div>","album"===i.type&&(o+='<div class="albumitem" data-id="'+i.id+'"><div class="trigger albumitem-trigger"><span></span></div><div class="content"></div></div>'),o+="</div>"+s.stddate(i.modified)+"</div>"}),r.style.visibility="hidden";var v=document.createElement("div");v.innerHTML=o,s.parsePostShare(v),e.on(t.query("div.albumitem-trigger",v),"click",function(){c.loadAbum(t.parent(this,"div.albumitem"))}),l(t.children(v))}else n(),u()},error:function(){}})}});u.start()},c.loadAbum=function(l){a.get("/query/albumitem/"+t.attr(l,"data-id"),function(a){var c="";i.each(a,function(i){c+='<a class="pin"><img height="315" width="240" src="'+i.img+'" /><div class="extra"><div class="mask"></div><div class="title">'+i.title+'</div><div class="desc">'+i.fullcontent+"</div></div></a>"});var o=t.get("div.content",l);o.innerHTML=c,i.each(t.children(o),function(t,n){e.on(t,"click",function(t){t.halt(),i.use("iee/fp.album",function(i,t){t.show(a,{switchTo:n}),s.parsePostShare()})})}),i.use("iee/fp.album"),t.css(o,{display:"block",position:"fixed",left:0,right:0,zIndex:-1});var d=t.height(o);t.css(o,{zIndex:"auto",position:"static",height:0}),new n(t.get("div.trigger",l),{height:0,opacity:0},.5,"easeOutStrong").run(),new n(o,{height:d},d/1e3,"easeBothStrong").run()},"json")},c},{requires:["dom","event","ajax","anim","iee/fp.base","iee/fp.waterfall"]});