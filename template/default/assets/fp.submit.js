KISSY.add("iee/fp.submit",function(e,t,i,n,s){var o={};o.init=function(){var e=t.get("#socialm");e&&(this._el=t.create('<div class="submiturl"></div>'),this._el.innerHTML='<div class="box"><div class="formCont"><span class="close"></span><span class="arrow"></span><div class="fieldCont"><form><div class="field-url"><input id="s1" name="url" autocomplete="off" type="text"><label for="s1">http://</label></div><div class="field-remark"><input id="s2" name="remark" autocomplete="off" type="text"><label for="s2">如果你愿意，可以在这里输入您的推荐理由</label></div><div class="field-nick"><input id="s3" name="nick" autocomplete="off" type="text"><label for="s3">输入你的昵称</label></div><div class="field-weibo"><input id="s4" name="weibo" autocomplete="off" type="text"><label for="s4">输入你的新浪微博账号</label></div></form></div><div class="field-btn"><button></button><span class="err"></span></div></div></div>',t.prepend(this._el,"#content"),this._container=t.get("div.box",this._el),this._fieldCont=t.get("div.fieldCont",this._el),this._formEl=t.get("form",this._el),this._errEl=t.get("span.err",this._el),this._formCont=t.get("div.formCont",this._el),this._trigger=t.create('<div class="submit"></div>'),this._trigger.innerHTML='<s></s><s class="arrow"></s>',e.appendChild(this._trigger),this._initEvents())};var r=!1,l=0;return o._initEvents=function(){var n=this;i.on(n._trigger,"click",function(){r?n._hide():(r=!0,t.removeClass(t.query("div.field-focus",n._el),"field-focus"),new s(n._el,{height:t.outerHeight(n._container)},.6,"easeOutStrong",function(){n._el.style.height="auto",t.addClass(n._trigger,"submit-expand")}).run())}),i.on(t.get("span.close",this._el),"click",function(){n._hide()}),e.each(t.query("input",n._el),function(s){i.on(s,"focus",function(){t.addClass(this.parentNode,"field-focus")});var o=s.name;"url"===o?i.on(s,"focus",function(){180>l&&n._expandBox(180)}):"remark"===o&&i.on(s,"focus",function(){220>l&&n._expandBox(220)}),i.on(s,"blur",function(){e.trim(this.value)||(this.value="",t.removeClass(this.parentNode,"field-focus"))})}),i.on(t.get("button",n._el),"click",function(e){e.halt(),n._submit()})},o._hide=function(){if(r){l=0,r=!1;var e=this;new s(e._el,{height:0},.6,"easeInStrong",function(){t.css(e._formCont,{opacity:1,display:"block"}),e._fieldCont.style.height="120px",e._errEl.innerHTML="",e._formEl.reset(),t.removeClass(e._trigger,"submit-expand"),t.remove(t.get("div.thanks",e._el))}).run()}},o._expandBox=function(e){l=e,new s(this._fieldCont,{height:e},.3,"easeOutStrong").run()},o._submit=function(){var i=this,o=i._formEl.elements.url;return e.trim(o.value)?void n({url:"/submit/commit",type:"post",form:i._formEl,success:function(){new s(i._formCont,{opacity:0},.3,"easeOutStrong",function(){var e=t.outerHeight(i._formCont);i._formCont.style.display="none";var n=t.create('<div class="thanks"></div>');t.insertAfter(n,i._formCont),n.style.height=e+"px",new s(n,{opacity:1},.4,"easeInStrong",function(){setTimeout(function(){i._hide()},2400)}).run()}).run()}}):void(i._errEl.innerHTML="请输入您要推荐的网址")},o},{requires:["dom","event","ajax","anim"]});