KISSY.add("iee/my.informationcompose",function(e,t,i,o,n,r,s){var a={};return a.init=function(){this.formEl=t.get("#informationComposeForm"),this.checkObj=new r(this.formEl),s.init(),t.get("#informationContent")&&(this.we=new tinymce.Editor("informationContent",{menubar:!1,statusbar:!1,plugins:"image textcolor colorpicker link fullscreen",toolbar:"bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | forecolor backcolor | bullist numlist | outdent indent blockquote | undo redo | link unlink | removeformat image | fullscreen"},tinymce.EditorManager),this.we.render())},a.publish=function(){this.submit("publish")},a.save=function(){this.submit("draft")},a.submit=function(e){var t=this;this.formEl.elements.operate.value=e,this.we&&(this.formEl.elements.content.value=this.we.getContent()),t.checkObj.validate(function(e){if(e){var i=new n.ProgressBar;i.show(),o({url:"/information/save",type:"post",form:t.formEl,dataType:"json",success:function(e){t.submitSuccess(e),i.hide()},error:function(){t.submitError(),i.hide()}})}})},a.submitSuccess=function(e){var t=this.getFeedbackModal(),i=this.formEl.elements,o="publish"===i.operate.value;if(e.success){i.id.value=e.id,t.setBody("资讯<strong>"+i.title.value+"</strong>"+(o?"保存并发布":"保存草稿")+"成功");var n=[{title:"查看资讯列表",href:"/information/all",target:"_self"},{title:"继续编辑",act:"my.informationcompose/closeFeedback"},{title:"撰写新资讯",href:"/information/create",target:"_self"}];o&&n.push({title:"查看资讯",href:"/i"+("0"!==e.sid?e.sid:e.id)}),t.setFooter(n),t.show()}else this.submitError(e)},a.submitError=function(e){var t=this.getFeedbackModal(),i="publish"===this.formEl.elements.operate.value;e=e||{},t.setBody('<div class="error">'+((i?"保存发布资讯":"保存草稿")+"失败")+(e.msg?"，<strong>"+e.msg+"</strong>":"")+"</div>"),t.setFooter([{title:"查看资讯列表",href:"/information/all",target:"_self"},{title:"返回编辑",act:"my.informationcompose/closeFeedback",primary:!0}]),t.show()},a.getFeedbackModal=function(){return this.feedbackModal||(this.feedbackModal=new n({title:t.text("#content h2"),cls:"postcompose-modal"})),this.feedbackModal},a.closeFeedback=function(){var e=this.feedbackModal;e&&e.hide()},a},{requires:["dom","event","ajax","iee/util.modal","iee/util.validation","iee/my.category"]});