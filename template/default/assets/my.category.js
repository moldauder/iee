KISSY.add("iee/my.category",function(e,t,a,i){var s={};return s.init=function(){this.el=t.get("#category"),this.render(window.categoryList),this.checkMax()},s.render=function(i){var s=this,n=s.el,c={};s.valueEl=t.get("input",n);var l={};e.each(s.valueEl.value.split(","),function(e){l[e]=!0}),e.each(i,function(e){var a=e.name.split("/"),i=c[a[0]];i||(i=t.create('<div class="item"></div>'),n.appendChild(i),c[a[0]]=i);var s=t.create("<span></span>");s.className="trigger"+(e.id in l?" selected":""),t.attr(s,"data-id",e.id),t.attr(s,"title",a.join(": ")),s.innerHTML=a.pop()+"<ins></ins>",i.appendChild(s)}),a.on(t.query("span",n),"click",function(){s.select(this)})},s.select=function(a){a.parentNode;if(t.hasClass(a,"selected"))t.removeClass(a,"selected");else{if(t.hasClass(this.el,"max"))return;t.addClass(a,"selected")}var i=[];e.each(t.query("span.selected",this.el),function(e){i.push(t.attr(e,"data-id"))}),this.valueEl.value=i.join(","),this.checkMax()},s.checkMax=function(){},s.update=function(e){i({type:"post",url:e.getAttribute("data-url")||"/item/put",data:{category:this.valueEl.value,id:this.valueEl.form.elements.id.value},success:function(a){var i=t.next(e,"span.tip");i||(i=t.create('<span class="tip"></span>'),t.insertAfter(i,e));var s="文章分类更新成功！";a.success||(s=a.msg),i.innerHTML=s}})},s},{requires:["dom","event","ajax"]});